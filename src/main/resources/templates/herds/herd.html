<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <head th:replace="partials/partials.html :: head('Herd')"></head>
    <meta th:name="_csrf" th:content="${_csrf.token}">
    <meta th:name="_csrf_header" th:content="${_csrf.headerName}">
    <link type="text/css" rel="stylesheet" href="/modaltest.css">
</head>
<body>
<!-- This is the navbar fragment / partial -->
<nav th:replace="partials/partials.html :: nav"></nav>

<!--  This is the main section of the page  -->
<section class="container py-5">
    <article class="d-flex justify-content-center">
        <div class="d-flex card py-1 bg-warning" style="width: 70%">
            <div class="d-flex justify-content-center">
                <h2 th:text="${herd_name}"></h2>
            </div>
            <div class="d-flex justify-content-center py-1">
                <span>HERD ID: </span><span th:text="${herd_id}"></span>
            </div>

            <!--  Add a New Goat Modal injection container  -->
            <div id="modal-container"></div>


            <div class="d-flex justify-content-center">
                <div class="px-3">
                    <button id="edit-herd-button" class="goat-button">Edit</button>
                </div>
                <div class="px-3">
                    <button id="delete-goat-button" class="goat-button">Delete</button>
                </div>
                <div class="px-3">
                    <button id="add-goat-button" class="goat-button">Add Goat</button>
                </div>
            </div>

            <!--Card container for the display of goats -->
            <div class="justify-content-center" id="herd-table">
                <div class="d-flex justify-content-center" th:each="goat : ${herd}">
                    <div class="card mb-3" style="width:80%;">
                        <div class="row g-0">
                            <div class="col-md-4 d-flex justify-content-center align-items-center">
                                <a target="_blank" href="https://our_domain_name/goats/${goat.id}"><img src="..."
                                                                                                        class="img-fluid rounded-start"
                                                                                                        alt="..."></a>
                            </div>
                            <div class="col-md-8">
                                <div class="card-body">
                                    <a th:href="@{/goat/{id}(id=${goat.id})}"><h4 class="card-title" th:text="${goat.name}"></h4></a>
                                    <h5 class="card-text" th:text="${goat.breed}"></h5>
                                    <h5 class="card-text" th:text="${goat.sex}"></h5>
                                    <h6 class="card-text">ID: <span th:text="${goat.id}"></span></h6>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </article>

    <!--    Bonus features if we can get to them, could possibly go here, or where ever we want  -->
    <article class="d-flex justify-content-center py-5">
        <h1>BONUS FEATURES MAYBE!!!!</h1>
    </article>

    <!--    Link to the top of the page (if we need it / for a large herd)  -->
    <article class="d-flex justify-content-center">
        <a href="#">Return to top of page</a>
    </article>
</section>

<!--  The following section is footer partial  -->
<section th:replace="partials/partials.html :: footer"></section>

<!-- Bootstrap CDN-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>

<!-- JQuery CDN-->
<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
        crossorigin="anonymous">
</script>

<!--  Custom Script -->
<script>
    // Event Listeners for all buttons
    // Add Goat Button
    $("#add-goat-button").on("click", () => {
        $("#modal-container").html(addGoatForm());
        document.getElementById("add-goat-cancel-button").addEventListener("click", () => {
            $("#modal-container").html("");
        });
        document.getElementById("add-goat-add-button").addEventListener("click", () => {
            addNewGoat();
        });
    });

    // Edit Herd Button
    $("#edit-herd-button").on("click", () => {
        $("#modal-container").html(editHerdForm());
        document.getElementById("edit-herd-cancel-button").addEventListener("click", () => {
            $("#modal-container").html("");
        });
        document.getElementById("edit-herd-submit-button").addEventListener("click", () => {
            console.log("hello");
            // saveEditHerd();
        });

    });


    // Add form for adding a new goat
    const addGoatForm = () => {
        return `<div class="modal-wrapper container py-3">
                <div>
                    <label for="name" style="width: 150px;" class="">Name</label>
                    <input type="text" id="name" name="name" style="width:300px;">
                </div>
                <div>
                    <label for="dob" style="width: 150px;" class="">Date of birth</label>
                    <input type="text" id="dob" name="dob" style="width:300px;" placeholder="yyyy-mm-dd">
                </div>
                <div>
                    <label for="breed" style="width: 150px;" class="">Breed</label>
                    <input type="text" id="breed" name="breed" style="width:300px;">
                </div>
                <div>
                    <label for="sex" style="width: 150px;" class="">Sex</label>
                    <input type="text" id="sex" name="sex" style="width:300px;">
                </div>
                <div>
                    <label for="tag_id" style="width: 150px;" class="">Tag ID</label>
                    <input type="text" id="tag_id" name="tag_id" style="width:300px;">
                </div>
                <div>
                    <label for="weight_in_pounds" style="width: 150px;" class="">Weight in pounds</label>
                    <input type="text" id="weight_in_pounds" name="weight_in_pounds" style="width:300px;">
                </div>
                <div>
                    <label for="herd_id" style="width: 150px;" class="">Herd ID</label>
                    <input type="text" id="herd_id" name="herd_id" style="width:300px;">
                </div>
                <div>
                    <label for="sire_name" style="width: 150px;" class="">Sire Name</label>
                    <input type="text" id="sire_name" name="sire_name" style="width:300px;">
                </div>
                <div>
                    <label for="dam_name" style="width: 150px;" class="">Dam Name</label>
                    <input type="text" id="dam_name" name="dam_name" style="width:300px;">
                </div>
                <div id="add-goat-button-container" class="d-flex justify-content-evenly py-1">
                    <button class="goat-button" id="add-goat-cancel-button">Cancel</button>
                    <button class="goat-button" id="add-goat-add-button" type="submit">Add Goat</button>
                </div>
            </div>
            `
    };

    // This function takes the data entered into the modal and sends it to java controller
    const addNewGoat = () => {
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");
        let settings = {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                name: $("#name").val(),
                dob: $("#dob").val(),
                breed: $("#breed").val(),
                sex: $("#sex").val(),
                tagId: $("#tag_id").val(),
                weightInPounds: $("#weight_in_pounds").val(),
                herdId: $("#herd_id").val(),
                sireName: $("#sire_name").val(),
                damName: $("#dam_name").val()
            })
        }
        settings.headers[header] = token;
        fetch("/add/new/goat", settings)
            .then(() => {
                location.reload();
            })
    }

    // Edit form for editing herd
    const editHerdForm = () => {
        return `
            <div class="modal-container-herd wrapper py-3">
                <div>
                    <label for="name" style="width: 150px;" class="">Herd Name</label>
                    <input type="text" id="name" name="name" style="width:300px;">
                </div>
                <div>
                    <label for="description" style="width: 150px;" class="">Herd Description</label>
                    <input type="text" id="description" name="description" style="width:300px;">
                </div>
                <div id="edit-herd-button-container" class="d-flex justify-content-evenly py-1">
                    <button class="herd-button" id="edit-herd-cancel-button">Cancel</button>
                    <button class="herd-button" id="edit-herd-submit-button">Save Changes</button>
                </div>
            </div>
            `
    }
    // This function takes the data entered into the modal and sends it to java controller

    const saveEditHerd = () => {
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");
        let settings = {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                herd_name: $("#name").val(),
                description: $("#description").val()
            })
        }
        settings.headers[header] = token;
        fetch("/edit/herds/id", settings)
            .then(() => {
                console.log("show");
                location.reload();
            })
    }

</script>
</body>
</html>